<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reignite â€“ Events</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="shared-styles.css">
</head>
<body>
  <header>
    <div class="header-left">
        <img src="newlogo.png" alt="Reignite Logo">
        <h1>Reignite</h1>
    </div>
    <div id="ali-ai-assistant-bar">
      <span class="mic-icon">ðŸŽ¤</span>
      <span class="assistant-name">Ali the AI Assistant</span>
      <span class="status-text">Tap to speak</span>
    </div>
  </header>

  <nav class="navbar">
    <ul id="navbar-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="events.html" class="active">Events</a></li> <li><a href="enrolled-events.html">My Enrolled Events</a></li>
      <li><a href="community-forum.html">Community Forum</a></li>
      <li><a href="health-resources.html">Health & Resources</a></li>
      <li><a href="login.html">Login/Register</a></li>
    </ul>
  </nav>

  <main id="events-list">
    <div class="event-counter-display">
        Event <span id="current-event-number">1</span> of <span id="total-event-count"></span>
    </div>

    <div class="events-container">
      <div class="event-card">
        <img src="/Users/laveenchordia/Desktop/pitchhh/taichi.jpg" alt="Tai Chi" class="event-card-main-img">
        <h2>Morning Yoga & Tai Chi <button class="event-ali-btn" data-event-id="event1">Ali</button></h2>
        <div class="event-details">
          <strong>Date:</strong> July 10, 2025<br>
          <strong>Time:</strong> 9:00 AM - 10:30 AM<br>
          <strong>Location:</strong> Bishan Community Centre (Multi-Purpose Hall)<br>
          <strong>Type:</strong> Sports (Gentle Pace)<br>
          <strong>Description:</strong> Enjoy gentle yoga and tai chi to boost your balance and flexibility. All seniors welcome, no experience needed. Mats are provided â€“ just come in comfortable clothes!<br>
          <strong>Accessibility:</strong> Wheelchair Accessible, Restrooms nearby
        </div>
        <button class="enroll-btn" data-event-id="event1">Enroll Now</button>
      </div>

      <div class="event-card">
        <img src="/Users/laveenchordia/Desktop/pitchhh/painting.jpg" alt="Painting Workshop" class="event-card-main-img">
        <h2>"Memories of Singapore" Painting Workshop <button class="event-ali-btn" data-event-id="event2">Ali</button></h2>
        <div class="event-details">
          <strong>Date:</strong> July 12, 2025<br>
          <strong>Time:</strong> 2:00 PM - 4:00 PM<br>
          <strong>Location:</strong> Tampines Arts Hub (Studio 3)<br>
          <strong>Type:</strong> Music & Arts<br>
          <strong>Description:</strong> Discover painting! Learn easy ways to paint Singapore scenes. No art experience? No problem! All painting supplies are provided.<br>
          <strong>Accessibility:</strong> Lift Access, Friendly Volunteers
        </div>
        <button class="enroll-btn" data-event-id="event2">Enroll Now</button>
      </div>

      <div class="event-card">
        <img src="/Users/laveenchordia/Desktop/pitchhh/checkers.jpg" alt="Chess & Checkers" class="event-card-main-img">
        <h2>Chess & Checkers Meetup <button class="event-ali-btn" data-event-id="event3">Ali</button></h2>
        <div class="event-details">
          <strong>Date:</strong> Every Friday<br>
          <strong>Time:</strong> 1:00 PM - 3:00 PM<br>
          <strong>Location:</strong> Jurong West Public Library (Activity Room)<br>
          <strong>Type:</strong> Social & Gatherings (Games)<br>
          <strong>Description:</strong> Challenge your mind with friendly chess and checkers games. Beginners to experts, all are welcome! It's a great way to meet new friends.<br>
          <strong>Accessibility:</strong> Quiet Environment, Seating provided
        </div>
        <button class="enroll-btn" data-event-id="event3">Enroll Now</button>
      </div>

      <div class="event-card">
        <img src="/Users/laveenchordia/Desktop/pitchhh/smartphone.jpg" alt="Smartphone Basics" class="event-card-main-img">
        <h2>Smartphone Basics for Seniors <button class="event-ali-btn" data-event-id="event4">Ali</button></h2>
        <div class="event-details">
          <strong>Date:</strong> July 18, 2025<br>
          <strong>Time:</strong> 10:00 AM - 12:00 PM<br>
          <strong>Location:</strong> Woodlands Active Ageing Centre (Computer Lab)<br>
          <strong>Type:</strong> Workshops & Learning<br>
          <strong>Description:</strong> Get confident with your smartphone! Learn how to make calls, take photos, and use useful apps. Remember to bring your own phone!<br>
          <strong>Accessibility:</strong> Well-lit room, Seated activity
        </div>
        <button class="enroll-btn" data-event-id="event4">Enroll Now</button>
      </div>

      <button id="prev-event-btn" class="carousel-nav-btn">&lt;</button>
      <button id="next-event-btn" class="carousel-nav-btn">&gt;</button>
    </div>

    <div class="filter-bar">
      <div class="filter-group">
        <label for="type">Event Type:</label>
        <select id="type">
          <option>All</option>
          <option>Sports (Badminton, Chess, etc.)</option>
          <option>Music & Arts (Singing, Pottery)</option>
          <option>Social & Gatherings (Coffee, Cards)</option>
          <option>Workshops & Learning (Tech, Crafts)</option>
          <option>Outings & Tours (Parks, Museums)</option>
          <option>Movie Night</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="location">Location:</label>
        <input type="text" id="location" placeholder="e.g. Bishan CC, Bedok">
      </div>
      <div class="filter-group">
        <label for="date">Date:</label>
        <input type="date" id="date">
      </div>
      <div class="filter-group">
        <label for="difficulty">Level:</label>
        <select id="difficulty">
          <option>All</option>
          <option>Gentle Pace</option>
          <option>Moderate</option>
          <option>Active</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="accessibility">Accessibility:</label>
        <select id="accessibility">
          <option>All</option>
          <option>Wheelchair Accessible</option>
          <option>Assisted Listening</option>
          <option>Quiet Environment</option>
        </select>
      </div>
      <button id="search-events-btn">Search Events</button>
    </div>
  </main>

  <div id="transcription-display"></div>

  <footer>
    <div class="footer-links">
      <ul>
        <li><a href="#">About Reignite</a></li>
        <li><a href="#">Contact Us</a></li>
        <li><a href="#">Privacy Policy</a></li>
        <li><a href="#">Terms of Service</a></li>
        <li><a href="#">Volunteer with Us</a></li>
        <li><a href="#">Partner with Us</a></li>
      </ul>
    </div>
    <p>&copy; 2025 Reignite. All rights reserved. Connecting seniors to vibrant community life in Singapore.</p>
  </footer>

  <script src="voice-assistant.js"></script>
  <script>
    // --- Event Carousel Logic ---
    const eventCards = document.querySelectorAll('.event-card');
    const prevEventBtn = document.getElementById('prev-event-btn');
    const nextEventBtn = document.getElementById('next-event-btn');
    const searchEventsBtn = document.getElementById('search-events-btn');

    // Get references to the number display elements
    const currentEventNumberSpan = document.getElementById('current-event-number');
    const totalEventCountSpan = document.getElementById('total-event-count');

    let currentEventIndex = 0;

    function showEvent(index) {
        eventCards.forEach((card, i) => {
            if (i === index) {
                card.classList.add('active');
            } else {
                card.classList.remove('active');
            }
        });
        // Update the current event number
        if (currentEventNumberSpan) {
            currentEventNumberSpan.innerText = index + 1;
        }
    }

    prevEventBtn.addEventListener('click', () => {
        currentEventIndex = (currentEventIndex - 1 + eventCards.length) % eventCards.length;
        showEvent(currentEventIndex);
    });

    nextEventBtn.addEventListener('click', () => {
        currentEventIndex = (currentEventIndex + 1) % eventCards.length;
        showEvent(currentEventIndex);
    });

    // Initial display of the first event card and total count
    document.addEventListener('DOMContentLoaded', () => {
        if (eventCards.length > 0) {
            showEvent(currentEventIndex);
            // Set the total event count on load
            if (totalEventCountSpan) {
                totalEventCountSpan.innerText = eventCards.length;
            }
        } else {
            // If no events, hide the counter or show a message
            if (currentEventNumberSpan) currentEventNumberSpan.parentNode.style.display = 'none';
        }

        // Add event listeners for new Ali buttons
        document.querySelectorAll('.event-ali-btn').forEach(aliBtn => {
            aliBtn.addEventListener('click', (event) => {
                event.stopPropagation(); // Prevent any parent click listeners
                const eventCard = aliBtn.closest('.event-card');
                if (eventCard) {
                    // Set the current event index to the card associated with this button
                    const index = Array.from(eventCards).indexOf(eventCard);
                    if (index !== -1) {
                        currentEventIndex = index;
                        showEvent(currentEventIndex); // Ensure this is the active card
                    }
                    // Call startListening from voice-assistant.js, passing the specific event card
                    // This tells the assistant which event to target if "enroll me" is heard.
                    if (window.startListening) { // Ensure the function is loaded
                         window.startListening(eventCard);
                    } else {
                         console.error("startListening function not found.");
                    }
                }
            });
        });

        // Add event listeners for Enroll Now buttons
        document.querySelectorAll('.enroll-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const eventCard = e.target.closest('.event-card');
                const eventTitleElement = eventCard.querySelector('h2');
                let eventTitle = eventTitleElement.textContent.trim();
                // Remove "Ali" from the title if it's there
                eventTitle = eventTitle.replace(/Ali$/, '').trim();

                const eventDetails = eventCard.querySelector('.event-details').innerHTML;
                const eventId = eventCard.dataset.eventId; // Get event ID from the button's data-event-id

                enrollEvent(eventId, eventTitle, eventDetails);
            });
        });
    });

    function enrollEvent(id, title, details) {
        let enrolledEvents = JSON.parse(localStorage.getItem('enrolledEvents')) || [];

        // Check if the event is already enrolled
        if (enrolledEvents.some(event => event.id === id)) {
            window.speak(`You are already enrolled for ${title}.`);
            return; // Exit if already enrolled
        }

        enrolledEvents.push({ id: id, title: title, details: details });
        localStorage.setItem('enrolledEvents', JSON.stringify(enrolledEvents));
        window.speak(`You have successfully enrolled for ${title}.`); // Voice confirmation
        console.log(`Enrolled in: ${title}`);
        // Optionally, you might want to redirect to the enrolled events page
        // window.location.href = "enrolled-events.html";
    }


    // --- Voice Assistant Commands for Events Page ---
    const eventTypeSelect = document.getElementById('type');
    const locationInput = document.getElementById('location');
    const dateInput = document.getElementById('date');
    const difficultySelect = document.getElementById('difficulty');
    const accessibilitySelect = document.getElementById('accessibility');

    // This processCommand function is called from voice-assistant.js
    // It uses currentEnrollmentTargetEventCard set by voice-assistant.js
    function processCommand(command) {
        // General navigation commands
        if (command.includes("go home") || command.includes("go to home page")) {
            window.speak("Taking you to the home page.");
            window.location.href = "index.html";
            return;
        } else if (command.includes("login") || command.includes("register") || command.includes("sign in")) {
            window.speak("Taking you to the login and registration page.");
            window.location.href = "login.html";
            return;
        } else if (command.includes("go to my enrolled events") || command.includes("my activities") || command.includes("show my events")) {
            window.speak("Taking you to your enrolled events.");
            window.location.href = "enrolled-events.html";
            return;
        } else if (command.includes("go to community forum") || command.includes("forum")) {
            window.speak("Navigating to the community forum.");
            window.location.href = "community-forum.html";
            return;
        } else if (command.includes("go to health and resources") || command.includes("show resources") || command.includes("health info")) {
            window.speak("Navigating to health and resources.");
            window.location.href = "health-resources.html";
            return;
        }

        // Events page specific commands
        if (command.includes("find sports events") || command.includes("show sports")) {
            eventTypeSelect.value = "Sports (Badminton, Chess, etc.)";
            window.speak("Filtering by sports events.");
        } else if (command.includes("show me movies") || command.includes("movie night")) {
            eventTypeSelect.value = "Movie Night";
            window.speak("Filtering by movie night events.");
        } else if (command.includes("find workshops") || command.includes("learning events")) {
            eventTypeSelect.value = "Workshops & Learning (Tech, Crafts)";
            window.speak("Filtering by workshops and learning events.");
        } else if (command.includes("events in")) {
            const match = command.match(/events in (.+)/);
            if (match && match[1]) {
                const location = match[1].trim();
                locationInput.value = location.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                window.speak(`Setting location to ${location}.`);
            } else {
                window.speak("Could you please specify the location?");
            }
        } else if (command.includes("set date to")) {
            const dateMatch = command.match(/set date to (.+)/);
            if (dateMatch && dateMatch[1]) {
                try {
                    const dateString = dateMatch[1].trim();
                    const parsedDate = new Date(dateString);
                    if (!isNaN(parsedDate.getTime())) {
                        const year = parsedDate.getFullYear();
                        const month = (parsedDate.getMonth() + 1).toString().padStart(2, '0');
                        const day = parsedDate.getDate().toString().padStart(2, '0');
                        dateInput.value = `${year}-${month}-${day}`;
                        window.speak(`Date set to ${dateString}.`);
                    } else {
                        window.speak("I couldn't understand that date. Please try a clearer format, like 'July 10, 2025'.");
                    }
                } catch (e) {
                    window.speak("I had trouble parsing that date. Please try again.");
                }
            } else {
                window.speak("What date would you like to set?");
            }
        } else if (command.includes("show gentle events") || command.includes("easy activities")) {
            difficultySelect.value = "Gentle Pace";
            window.speak("Filtering by gentle pace activities.");
        } else if (command.includes("show accessible events") || command.includes("wheelchair friendly")) {
            accessibilitySelect.value = "Wheelchair Accessible";
            window.speak("Filtering by wheelchair accessible events.");
        } else if (command.includes("search now") || command.includes("apply filters")) {
            searchEventsBtn.click(); // Click the search button
            window.speak("Performing search now.");
        } else if (command.includes("next event") || command.includes("show next")) {
            nextEventBtn.click();
            window.speak("Showing the next event.");
        } else if (command.includes("previous event") || command.includes("show previous")) {
            prevEventBtn.click();
            window.speak("Showing the previous event.");
        } else if (command.includes("enroll me for this event") || command.includes("enroll for this event")) {
            // Use the specific card passed from the "Ali" button click, or fallback to current carousel event
            let targetCard = window.currentEnrollmentTargetEventCard;
            if (!targetCard) {
                targetCard = eventCards[currentEventIndex];
            }

            if (targetCard) {
                const eventTitleElement = targetCard.querySelector('h2');
                let eventTitle = eventTitleElement.textContent.trim();
                // Remove "Ali" from the title if it's there
                eventTitle = eventTitle.replace(/Ali$/, '').trim();

                const eventDetails = targetCard.querySelector('.event-details').innerHTML;
                const eventId = targetCard.querySelector('.event-ali-btn')?.dataset.eventId || "event-" + Date.now(); // Use existing ID or generate new

                enrollEvent(eventId, eventTitle, eventDetails);
            } else {
                window.speak("I cannot find an event to enroll for. Please make sure an event is visible or specify which one.");
            }
        } else {
            window.speak("I can help you filter events, show the next or previous event, or 'enroll me for this event'. You can also say 'Go home' to return to the homepage.");
        }
    }
    // Expose processCommand to the global scope so voice-assistant.js can call it
    window.processCommand = processCommand;
  </script>
</body>
</html>